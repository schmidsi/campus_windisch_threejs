var loader=new THREE.XHRLoader,APP={Player:function(){function e(e,t){for(var n=0,o=e.length;o>n;n++)try{e[n](t)}catch(i){console.error(i.message||i,i.stack||"")}}function t(n){y=requestAnimationFrame(t),e(f.update,{time:n,delta:n-E}),v===!0?(p.update(),w.render(m,c)):h.render(m,c),E=n}function n(t){e(f.keydown,t)}function o(t){e(f.keyup,t)}function i(t){e(f.mousedown,t)}function r(t){e(f.mouseup,t)}function s(t){e(f.mousemove,t)}function d(t){e(f.touchstart,t)}function a(t){e(f.touchend,t)}function u(t){e(f.touchmove,t)}var c,m,h,v,p,w,l=new THREE.ObjectLoader,f={};this.dom=void 0,this.width=500,this.height=500,this.load=function(t){v=!1,h=new THREE.WebGLRenderer({antialias:!0}),h.setClearColor(0),h.setPixelRatio(window.devicePixelRatio),t.project.shadows&&(h.shadowMap.enabled=!0),this.dom=h.domElement,this.setScene(l.parse(t.scene)),this.setCamera(l.parse(t.camera)),f={init:[],start:[],stop:[],keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[],touchstart:[],touchend:[],touchmove:[],update:[]};var n="player,renderer,scene",o={};for(var i in f)n+=","+i,o[i]=i;var r=JSON.stringify(o).replace(/\"/g,"");for(var s in t.scripts)for(var d=m.getObjectByProperty("uuid",s,!0),a=t.scripts[s],u=0;u<a.length;u++){var c=a[u],p=new Function(n,c.source+"\nreturn "+r+";").bind(d)(this,h,m);for(var w in p)void 0!==p[w]&&(void 0!==f[w]?f[w].push(p[w].bind(d)):console.warn("APP.Player: event type not supported (",w,")"))}e(f.init,arguments)},this.setCamera=function(e){if(c=e,c.aspect=this.width/this.height,c.updateProjectionMatrix(),v===!0){null===c.parent&&m.add(c);var t=c.clone();c.add(t),c=t,p=new THREE.VRControls(c),w=new THREE.VREffect(h),document.addEventListener("keyup",function(e){switch(e.keyCode){case 90:p.zeroSensor()}}),this.dom.addEventListener("dblclick",function(){w.setFullScreen(!0)})}},this.setScene=function(e){m=e},this.setSize=function(e,t){h._fullScreen||(this.width=e,this.height=t,c.aspect=this.width/this.height,c.updateProjectionMatrix(),h.setSize(e,t))};var E,y;this.play=function(){document.addEventListener("keydown",n),document.addEventListener("keyup",o),document.addEventListener("mousedown",i),document.addEventListener("mouseup",r),document.addEventListener("mousemove",s),document.addEventListener("touchstart",d),document.addEventListener("touchend",a),document.addEventListener("touchmove",u),e(f.start,arguments),y=requestAnimationFrame(t),E=(window.performance||Date).now()},this.stop=function(){document.removeEventListener("keydown",n),document.removeEventListener("keyup",o),document.removeEventListener("mousedown",i),document.removeEventListener("mouseup",r),document.removeEventListener("mousemove",s),document.removeEventListener("touchstart",d),document.removeEventListener("touchend",a),document.removeEventListener("touchmove",u),e(f.stop,arguments),cancelAnimationFrame(y)}}};loader.load("./scripts/scene.json",function(e){var t=new APP.Player;t.load(JSON.parse(e)),t.setSize(window.innerWidth,window.innerHeight),t.play(),document.body.appendChild(t.dom),window.addEventListener("resize",function(){t.setSize(window.innerWidth,window.innerHeight)})});